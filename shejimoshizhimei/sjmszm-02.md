# 设计原则与思想：面向对象

## 04-理论一：当谈论面向对象的时候，我们到底在谈论什么？



类（class）和对象（object）



面向对象编程是一种**编程范式或编程风格**。

面向对象编程语言是**支持类或对象的语法机制，并有现成的语法机制，能方便地实现面向对象编程四大特性（封装、抽象、继承、多态）的编程语言**。



面向对象分析（OOA） ->  面向对象设计（OOD）  -> OOP





UML（Unified Model Language），统一建模语言



## 05-理论二：封装、抽象、继承、多态分别可以解决哪些编程问题？



### 封装（Encapsulation）

**信息隐藏**或者**数据访问保护**



### 抽象（Abstraction）

**如何隐藏方法的具体实现**，让调用者**只需要关心方法提供了哪些功能**，并不需要知道这些功能是如何实现的。

函数本身也是一种抽象，调用者在使用函数的时候，并不需要去研究函数内部的实现逻辑，只需要通过函数的命名、注释或者文档，了解其提供了什么功能，就可以直接使用了。



保证在某个时间点需要改变方法的实现逻辑的时候，不用去修改其定义。



### 继承（Inheritance）

过度使用继承，继承层次过深过复杂，就会导致代码可读性、可维护性变差。



### 多态（Polymorphism）

三种实现方式：

- 继承加方法重写
- 利用接口类语法
- 利用 duck-typing 语法





### 总结

**What/How/Why 模型**

封装
What：隐藏信息，保护数据访问。
How：暴露有限接口和属性，需要编程语言提供访问控制的语法。
Why：提高代码可维护性；降低接口复杂度，提高类的易用性。

抽象
What: 隐藏具体实现，使用者只需关心功能，无需关心实现。
How: 通过接口类或者抽象类实现，特殊语法机制非必须。
Why: 提高代码的扩展性、维护性；降低复杂度，减少细节负担。

继承
What: 表示 is-a 关系，分为单继承和多继承。
How: 需要编程语言提供特殊语法机制。例如 Java 的 “extends”，C++ 的 “:” 。
Why: 解决代码复用问题。

多态
What: 子类替换父类，在运行时调用子类的实现。
How: 需要编程语言提供特殊的语法机制。比如继承、接口类、duck-typing。
Why: 提高代码扩展性和复用性。

3W 模型的关键在于 Why，没有 Why，其它两个就没有存在的意义。从四大特性可以看出，面向对象的终极目的只有一个：可维护性。易扩展、易复用、降低复杂度等等都属于可维护性的实现方式。



## 06-理论三：面向对象相比面向过程有哪些优势？面向过程真的过时了吗？



### 什么是面向过程编程与面向过程编程语言？

面向过程编程，以过程（可以理解为方法、函数、操作）作为组织代码的基本单元，以**数据（可以理解为成员变量、属性）与方法相分离**。

面向过程编程语言，不支持类和对象两个语法概念，不支持丰富的面向对象编程特性（比如继承、多态、封装），仅支持面向过程编程。



面向对象风格的代码，方法和数据结构被绑定一起，定义在类中。



### 面向对象编程相比面向过程编程有哪些优势？

#### 1.更加能够应对大规模复杂程序的开发

以类为思考对象，先去思考**如何给业务建模，如何将需求翻译为类，如何给类之间建立交互关系**，而完成这些工作完全不需要考虑错综复杂的处理流程。

类就是一种非常好的组织这些函数和数据结构的方式，是一种将**代码模块化**的有效手段。

#### 2.更易复用、易扩展、易维护

将数据和方法绑定在一起，通过访问权限控制，只允许外部调用者通过类暴露的有限方法访问数据。

#### 3.更加人性化、更加高级、更加智能

`二进制指令 > 汇编语言 > 高级编程语言`

**越高级的编程语言离机器越“远”，离我们人类越“近”，越“智能”。**

> 大胆想象一下，使用这种编程语言，我们可以无需对计算机知识有任何了解，无需像现在这样一行一行地敲很多代码，只需要把<font color=#FF8C00>**需求文档**</font>写清楚，就能自动生成我们想要的软件了。



### 问题

在文章中我讲到，面向对象编程比面向过程编程，更加容易应对大规模复杂程序的开发。但像 Unix、Linux 这些复杂的系统，也都是基于 C 语言这种面向过程的编程语言开发的，你怎么看待这个现象？这跟我之前的讲解相矛盾吗？



对于所有编程语言最终目的是两种：提高硬件的运行效率和提高程序员的开发效率。然而这两种很难兼得。
C语言在效率方面几乎做到了极致，它更适合挖掘硬件的价值，它只关心程序飞的高不高，不关心程序猿飞的累不累。



## 07-理论四：哪些代码设计看似是面向对象，实际是面向过程的？



### 哪些代码设计看似是面向对象，实际是面向过程的？

#### 1. 滥用 getter、setter 方法

在设计实现类的时候，除非真的需要，否则，尽量不要给属性定义 setter 方法。

尽管 getter 方法相对 setter 方法要安全些，但是如果返回的是集合容器（比如例子中的 List 容器），也要防范集合内部数据被修改的危险。



#### 2. 滥用全局变量和全局方法

在面向对象编程中，常见的全局变量有**单例类对象、静态成员变量、常量**等，常见的全局方法有**静态方法**。

Constants 类和 Utils 类

#### 3. 定义数据和方法分离的类

基于贫血模型的开发模式





### 在面向对象编程中，为什么容易写出面向过程风格的代码？





### 面向过程编程及面向过程编程语言就真的无用武之地了吗？

面向过程编程是面向对象编程的基础，面向对象编程离不开基础的面向过程编程。



## 08-理论五：接口vs抽象类的区别？如何用普通的类模拟抽象类和接口？



### 什么是抽象类和接口？区别在哪里？

抽象类的特性：

- 抽象类不允许被实例化，只能被继承。
- 抽象类可以包含属性和方法。方法既可以包含代码实现，也可以不包含代码实现（**抽象方法**）。
- 子类继承抽象类，必须实现抽象类中的所有抽象方法。

接口的特性：

- 接口不能包含属性（也就是成员变量）。
- 接口只能声明方法，方法不能包含代码实现。
- 类实现接口的时候，必须实现接口中声明的所有方法。

抽象类是 **is-a** 关系。接口是 **has-a** 关系，表示具有某些功能。接口的另一个形象的叫法是**协议**（contract）。

### 抽象类和接口能解决什么编程问题？

抽象类

- 除了代码复用，还可以让人弄明白设计意图
- 强制
- 优雅解决，父类被实例化后的误用风险

接口侧重**解耦**。

实际上，接口是一个比抽象类应用更加广泛、更加重要的知识点

### 如何模拟抽象类和接口两个语法概念？



### 如何决定该用抽象类还是接口？



## 09-理论六：为什么基于接口而非实现编程？有必要为每个类都定义接口吗？



### 如何解读原则中的“接口”二字？

“基于接口而非实现编程”这条原则的英文描述是：“**Program to an interface, not an implementation**”。

这条原则先于很多编程语言而诞生（比如 Java 语言），是一条比较抽象、泛化的设计思想。

从本质上来看，“接口”就是一组“协议”或者“约定”，是功能提供者提供给使用者的一个“**功能列表**”。

在软件开发中，最大的挑战之一就是**需求的不断变化**。

**越抽象、越顶层、越脱离具体某一实现的设计，越能提高代码的灵活性，越能应对未来的需求变化。好的代码设计，不仅能应对当下的需求，而且在将来需求发生变化的时候，仍然能够在不破坏原有代码设计的情况下灵活应对。**



### 如何将这条原则应用到实战中？

做软件开发的时候，一定要有**抽象意识、封装意识、接口意识**。

接口的定义**只表明做什么，而不是怎么做**。



### 是否需要为每个类定义接口？

搞清楚这条原则是为了解决什么样的问题而产生的。

越是不稳定的系统，我们越是要在代码的扩展性、维护性上下功夫。

## 10-理论七：为何说要多用组合少用继承？如何决定该用组合还是继承？

继承最大的问题就在于：**继承层次过深、继承关系过于复杂会影响到代码的可读性和可维护性**。





## 11-实战一（上）：业务开发常用的基于贫血模型的MVC架构违背OOP吗？

领域驱动设计（Domain Driven Design，简称 DDD）



### 什么是基于贫血模型的传统开发模式？

只包含数据，不包含业务逻辑的类，就叫作**贫血模型**（Anemic Domain Model）。



### 什么是基于充血模型的 DDD 开发模式？

**充血模型**（Rich Domain Model）正好相反，数据和对应的业务逻辑被封装到同一个类中。



#### 什么是领域驱动设计？

主要是用来指导**如何解耦业务系统，划分业务模块，定义业务领域模型及其交互**。

**微服务**



### 为什么基于贫血模型的传统开发模式如此受欢迎？



### 什么项目应该考虑使用基于充血模型的 DDD 开发模式？





## 12-实战一（下）：如何利用基于充血模型的DDD开发一个虚拟钱包系统？

??



## 13-实战二（上）：如何对接口鉴权这样一个功能开发做面向对象分析？



“如何做需求分析，如何做职责划分？需要定义哪些类？每个类应该具有哪些属性、方法？类与类之间该如何交互？如何组装类成一个可执行的程序？”



## 14-实战二（下）：如何利用面向对象设计和编程开发接口鉴权功能？

### 如何进行面向对象设计？

#### 1. 划分职责进而识别出有哪些类

类是现实世界中事物的一个<font color=#FF8C00>**建模**</font>。不是每个需求都能映射到现实世界，不是每个类都与现实世界中的事物一一对应。

把需求描述中的**名词**罗列出来，作为可能的候选类，然后再进行筛选。

根据需求描述，把其中涉及的**功能点**，一个一个罗列出来，然后再去看哪些功能点职责相近，操作同样的属性，可否应该归为同一个类。

#### 2. 定义类及其属性和方法



#### 3. 定义类与类之间的交互关系



#### 4. 将类组装起来并提供执行入口



### 如何进行面向对象编程？

